generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model School {
  id        Int      @id @default(autoincrement())
  name      String
  city      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  quizEvents QuizEvent[]
}

model QuizEvent {
  id        Int       @id @default(autoincrement())
  name      String // e.g. "St.Joseph Senior 2025"
  level     QuizLevel
  date      DateTime
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  schoolId Int
  school   School @relation(fields: [schoolId], references: [id])

  teams  Team[]
  rounds Round[]
}

enum QuizLevel {
  JUNIOR
  SENIOR
}

model Team {
  id         Int      @id @default(autoincrement())
  name       String
  color      String? // optional, for UI
  totalScore Int      @default(0)
  used5050   Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  quizEventId Int
  quizEvent   QuizEvent @relation(fields: [quizEventId], references: [id])

  answers      AnswerLog[]
  buzzerEvents BuzzerEvent[]
  scores       RoundScore[]
}

model Round {
  id        Int       @id @default(autoincrement())
  name      String
  order     Int
  type      RoundType
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  quizEventId Int
  quizEvent   QuizEvent @relation(fields: [quizEventId], references: [id])

  questions   Question[]
  roundScores RoundScore[] // <-- FIX added
}

enum RoundType {
  TIME_TELLER
  PUZZLE
  RAPID_FIRE
  BUZZER
}

model Question {
  id            Int             @id @default(autoincrement())
  text          String
  optionA       String?
  optionB       String?
  optionC       String?
  optionD       String?
  correctOption QuestionOption?
  mediaURL      String?
  timeLimitSec  Int
  points        Int
  orderInRound  Int
  type          QuestionType

  roundId Int
  round   Round @relation(fields: [roundId], references: [id])

  answers      AnswerLog[]
  buzzerEvents BuzzerEvent[] // <-- FIX added
}

enum QuestionType {
  MCQ
  PUZZLE
  RAPID
  BUZZER
}

enum QuestionOption {
  A
  B
  C
  D
}

model AnswerLog {
  id             Int             @id @default(autoincrement())
  teamId         Int
  questionId     Int
  selectedOption QuestionOption?
  isCorrect      Boolean
  pointsAwarded  Int
  answeredAt     DateTime        @default(now())

  team     Team     @relation(fields: [teamId], references: [id])
  question Question @relation(fields: [questionId], references: [id])
}

model RoundScore {
  id      Int @id @default(autoincrement())
  teamId  Int
  roundId Int
  score   Int @default(0)

  team  Team  @relation(fields: [teamId], references: [id])
  round Round @relation(fields: [roundId], references: [id])
}

model BuzzerEvent {
  id         Int      @id @default(autoincrement())
  teamId     Int
  questionId Int
  pressedAt  DateTime @default(now())

  team     Team     @relation(fields: [teamId], references: [id])
  question Question @relation(fields: [questionId], references: [id])
}
